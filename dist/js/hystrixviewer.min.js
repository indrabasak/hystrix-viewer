!function(t,a){"function"==typeof define&&define.amd?define(["jquery","d3"],a):"object"==typeof exports?module.exports=a(require("jquery"),require("d3")):t.HV=a(t.jQuery,t.d3)}(this,function(t,a){function e(a){var e=t("<div></div>").addClass("row");t(a).append(e);var i=t("<div></div>").addClass("hystrix-menubar");t(e).append(i);var s=t("<div></div>").addClass("title").text("Circuit");t(i).append(s);var r=t("<div></div>").addClass("menu_actions").html('Sort: <a href="javascript://" onclick="HV.sortByErrorThenVolume();">Error then Volume</a> | <a href="javascript://" onclick="HV.sortAlphabetically();">Alphabetical</a> | <a href="javascript://" onclick="HV.sortByVolume();">Volume</a> | <a href="javascript://" onclick="HV.sortByError();">Error</a> | <a href="javascript://" onclick="HV.sortByLatencyMean();">Mean</a> | <a href="javascript://" onclick="HV.sortByLatencyMedian();">Median</a> | <a href="javascript://" onclick="HV.sortByLatency90();">90</a> | <a href="javascript://" onclick="HV.sortByLatency99();">99</a> | <a href="javascript://" onclick="HV.sortByLatency995();">99.5</a> ');t(i).append(r);var d=t("<div></div>").addClass("menu_legend").html('<span class="success">Success</span> | <span class="shortCircuited">Short-Circuited</span> | <span class="badRequest"> Bad Request</span> | <span class="timeout">Timeout</span> | <span class="rejected">Rejected</span> | <span class="failure">Failure</span> | <span class="errorPercentage">Error %</span>');t(i).append(d),I="dependencies";var n=t("<div></div>").attr("id",I).addClass("row").addClass("dependencies");t(a).append(n)}function i(a){var e=t("<div></div>").addClass("row");t(a).append(e);var i=t("<div></div>").addClass("hystrix-menubar");t(e).append(i);var s=t("<div></div>").addClass("title").text("Thread Pools");t(i).append(s);var r=t("<div></div>").addClass("menu_actions").html('Sort: <a href="javascript://" onclick="HV.sortThreadpoolAlphabetically();">Alphabetical</a> | <a href="javascript://" onclick="HV.sortThreadpoolByVolume();">Volume</a>');t(i).append(r),S="dependencyThreadPools";var d=t("<div></div>").attr("id",S).addClass("row").addClass("dependencyThreadPools");t(a).append(d)}function s(t){if(t.startsWith("gauge.hystrix.HystrixCommand")){var a=t.split(".");if(6==a.length){var e=a[0]+"."+a[1]+"."+a[2]+"."+a[3]+"."+a[4];if(!_[e]){var i=new l(I,e,a[3],a[4]);_[e]=i}}}}function r(t){if(t.startsWith("gauge.hystrix.HystrixThreadPool")){var a=t.split(".");if(5==a.length){var e=a[0]+"."+a[1]+"."+a[2]+"."+a[3];if(!x[e]){var i=new u(S,e,a[3]);x[e]=i}}}}function d(t,a,e){var i=e;if(t[g.GAUGE.type]){var s=t[g.GAUGE.type][a];if(s)try{s.value&&(i=c(s.value,4))}catch(t){}}return i}function n(t){var a=Math.round(t*Math.pow(10,1))/Math.pow(10,1),e=a.toString();return-1==e.indexOf(".")&&(e+=".0"),e}function c(t,a){a||(a=4);var e=Math.pow(10,a),i=t*e;return Math.round(i)/e}function l(e,i,s,r){this.parentDivId=e,this.circuitKey=i,this.serviceName=s,this.methodName=r,this.suffix=this.serviceName+"_"+this.methodName,this.initialized=!1,this.circuitDivId="CIRCUIT_"+this.suffix,this.chartDivId="chart_CIRCUIT_"+this.suffix,this.dataDivId=this.chartDivId+"_monitor_data",this.graphDivId="graph_CIRCUIT_"+this.suffix,this.data={},this.graphData=[],this.render=function(){if(!this.initialized){var a=t("<div></div>").attr("id",this.circuitDivId).addClass("monitor").css({position:"relative"});t("#"+this.parentDivId).append(a),this.addChart(a),this.addTitle(a),this.addData(a),this.addSparkline(a),this.initialized=!0}},this.refresh=function(t){this.preProcessData(t),this.render(),this.updateCircle(),this.updateData(),this.updateSparkline()},this.clear=function(){t(this.circuitDivId).empty(),delete this.circuitDivId,t(this.chartDivId).empty(),delete this.chartDivId,t(this.dataDivId).empty(),delete this.dataDivId,t(this.graphDivId).empty(),delete this.graphDivId,delete this.data,delete this.graphData},this.addChart=function(a){var e=t("<div></div>").attr("id",this.chartDivId).addClass("chart").css({position:"absolute",top:"0px",left:"0",float:"left",width:"100%",height:"100%"});a.append(e),this.addCircle(this.chartDivId)},this.addCircle=function(t){a.select("#"+t).append("svg:svg").attr("width","100%").attr("height","100%").append("svg:circle").style("fill","green").attr("cx","30%").attr("cy","30%").attr("r",5)},this.updateCircle=function(){var t=j(this.data.ratePerSecondPerHost);parseInt(t,10)>parseInt(m,10)&&(t=m);var e=T(this.data.ratePerSecondPerHost);parseInt(e,10)>parseInt(C,10)&&(e=C);var i=R(this.data.ratePerSecondPerHost);parseInt(i,10)>parseInt(D,10)&&(i=D),a.selectAll("#"+this.chartDivId+" circle").transition().duration(400).attr("cy",e).attr("cx",t).attr("r",i).style("fill",V(this.data.errorPercentage))},this.addTitle=function(a){var e='<p class="name"'+this.serviceName+"."+this.methodName+">"+this.serviceName+"."+this.methodName+"</p>",i=t("<div></div>").css({position:"absolute",top:"0px",width:"100%",height:"15px",opacity:"0.8",background:"white"}).html(e);a.append(i)},this.addData=function(a){var e=t("<div></div>");t(e).css({position:"absolute",top:"15px",opacity:"0.8",background:"white",width:"100%",height:"95%"}),a.append(e);var i=t("<div></div>").attr("id",this.dataDivId).addClass("monitor_data");e.append(i)},this.updateData=function(){if(this.initialized){var a=t("#"+this.dataDivId);a.empty(),this.addCounters(a),this.addRate(a),this.addCircuitStatus(a),this.addDataTable(a),t("#"+this.circuitDivId).attr("rate_value",this.data.ratePerSecond).attr("error_then_volume",this.data.errorThenVolume),t("#"+this.circuitDivId+" a.errorPercentage").css("color",w(this.data.errorPercentage))}},this.addCounters=function(a){var e=t("<div></div>").addClass("counters");a.append(e);var i=t("<div></div>").addClass("cell line").html('<a href="javascript://" title="Error Percentage [Timed-out + Threadpool Rejected + Failure / Total]"class="hystrix-tooltip errorPercentage"><span class="value">'+this.data.errorPercentage+"</span>%</a>");e.append(i);var s,r='<a href="javascript://" title="Timed-out Request Count"class="line hystrix-tooltip timeout"><span class="value">'+this.data.rollingCountTimeout+"</span></a>";s=this.data.rollingCountThreadPoolRejected?'<a href="javascript://" title="Threadpool Rejected Request Count"class="line hystrix-tooltip rejected"><span class="value">'+this.data.rollingCountThreadPoolRejected+"</span></a>":'<a href="javascript://" title="Semaphore Rejected Request Count"class="line hystrix-tooltip rejected"><span class="value">'+this.data.rollingCountSemaphoreRejected+"</span></a>";var d='<a href="javascript://" title="Failure Request Count"class="line hystrix-tooltip failure"><span class="value">'+this.data.rollingCountFailure+"</span></a>",n=t("<div></div>").addClass("cell borderRight").html(r+"\n"+s+"\n"+d);e.append(n);var c='<a href="javascript://" title="Successful Request Count"class="line hystrix-tooltip success"><span class="value">'+this.data.rollingCountSuccess+"</span></a>",l='<a href="javascript://" title="Short-circuited Request Count"class="line hystrix-tooltip shortCircuited"><span class="value">'+this.data.rollingCountShortCircuited+"</span></a>",o='<a href="javascript://" title="Bad Request Count"class="line hystrix-tooltip badRequest"><span class="value">'+this.data.rollingCountBadRequests+"</span></a>",h=t("<div></div>").addClass("cell borderRight").html(c+"\n"+l+"\n"+o);e.append(h)},this.addRate=function(a){var e='<a href="javascript://" title="Total Request Rate per Second per Reporting Host"class="hystrix-tooltip rate"><span class="smaller">Host: </span><span class="ratePerSecondPerHost">'+this.data.ratePerSecondPerHost+"</span>/s</a>",i=t("<div></div>").addClass("rate").html(e);a.append(i);var s='<a href="javascript://" title="Total Request Rate per Second for Cluster"class="hystrix-tooltip rate"><span class="smaller">Cluster: </span><span class="ratePerSecond">'+this.data.ratePerSecond+"</span>/s</a>",r=t("<div></div>").addClass("rate").html(s);a.append(r)},this.addCircuitStatus=function(a){var e=t("<div></div>").addClass("circuitStatus").html('Circuit <font color="green">Closed</font>');a.append(e)},this.addDataTable=function(a){var e=t("<div></div>").addClass("spacer");a.append(e);var i=t('<div class="tableRow"><div class="cell header">Hosts</div><div class="cell data">'+this.data.reportingHosts+' </div><div class="cell header">90th</div><div class="cell data latency90"><span class="value">'+this.data.latency90+"</span>ms </div></div>");a.append(i);var s=t('<div class="tableRow"><div class="cell header">Median</div><div class="cell data latencyMedian"><span class="value">'+this.data.latencyMedian+'</span>ms </div><div class="cell header">99th</div><div class="cell data latency99"><span class="value">'+this.data.latency99+"</span>ms </div></div>");a.append(s);var r=t('<div class="tableRow"><div class="cell header">Mean</div><div class="cell data latencyMean"><span class="value">'+this.data.latencyMean+'</span>ms</div><div class="cell header">99.5th</div><div class="cell data latency995"><span class="value">'+this.data.latency995+"</span>ms</div></div>");a.append(r)},this.addSparkline=function(e){var i=t("<div></div>").attr("id",this.graphDivId).addClass("graph").css({position:"absolute",top:"25px",left:"0",float:"left",width:"140px",height:"62px"});e.append(i),a.select("#"+this.graphDivId).append("svg:svg").attr("width","100%").attr("height","100%").append("svg:path")},this.updateSparkline=function(){var t=(new Date).getTime();for(this.graphData.push({v:parseFloat(this.data.ratePerSecond),t:t});this.graphData.length>200;)this.graphData.shift();if(1!==this.graphData.length||0!==this.graphData[0].v){this.graphData.length>1&&0===this.graphData[0].v&&0!==this.graphData[1].v&&this.graphData.shift();var e=a.scaleTime().domain([new Date(t-12e4),new Date(t)]).range([0,140]),i=a.min(this.graphData,function(t){return t.v}),s=a.max(this.graphData,function(t){return t.v}),r=a.scaleLinear().domain([i,s]).nice().range([60,0]),d=a.line().x(function(t){return e(new Date(t.t))}).y(function(t){return r(t.v)}).curve(a.curveBasis),n=this.graphData;a.selectAll("#"+this.graphDivId+" path").attr("d",function(t,a){return d(n)})}},this.preProcessData=function(t){this.data={};var a=d(t,this.circuitKey+".propertyValue_metricsRollingStatisticalWindowInMilliseconds",0)/1e3,e=d(t,this.circuitKey+".requestCount",0);e<0&&(e=0);var i=d(t,this.circuitKey+".reportingHosts",0);this.data.ratePerSecond=n(e/a),this.data.ratePerSecondPerHost=n(e/a/i),this.data.ratePerSecondPerHostDisplay=this.data.ratePerSecondPerHost,this.data.errorPercentage=d(t,this.circuitKey+".errorPercentage",0),this.data.errorThenVolume=isNaN(this.data.ratePerSecond)?-1:1e8*this.data.errorPercentage+this.data.ratePerSecond,this.data.rollingCountTimeout=d(t,this.circuitKey+".rollingCountTimeout",0);var s=d(t,this.circuitKey+".rollingCountThreadPoolRejected",-20);-20===s?this.data.rollingCountSemaphoreRejected=d(t,this.circuitKey+".rollingCountSemaphorePoolRejected",0):this.data.rollingCountThreadPoolRejected=s,this.data.rollingCountFailure=d(t,this.circuitKey+".rollingCountFailure",0),this.data.rollingCountSuccess=d(t,this.circuitKey+".rollingCountSuccess",0),this.data.rollingCountShortCircuited=d(t,this.circuitKey+".rollingCountShortCircuited",0),this.data.rollingCountBadRequests=d(t,this.circuitKey+".rollingCountBadRequests",0),this.data.reportingHosts=d(t,this.circuitKey+".reportingHosts",1),this.data.latency90=d(t,this.circuitKey+".90",0),this.data.latencyMedian=d(t,this.circuitKey+".50",0),this.data.latency99=d(t,this.circuitKey+".99",0),this.data.latencyMean=d(t,this.circuitKey+".latencyExecute_mean",0),this.data.latency995=d(t,this.circuitKey+".99.5",0)}}function o(a){var e=t("#dependencies div.monitor");b="rate_"+a,e.tsort({order:a,attr:"rate_value"})}function h(a){var e=t("#dependencies div.monitor");b="error_"+a,e.tsort(".errorPercentage .value",{order:a})}function p(a){var e=t("#dependencies div.monitor");b="error_then_volume_"+a,e.tsort({order:a,attr:"error_then_volume"})}function v(a){var e=t("#dependencies div.monitor");b="alph_"+a,e.tsort("p.name",{order:a})}function u(e,i,s){this.parentDivId=e,this.circuitKey=i,this.serviceName=s,this.data={},this.initialized=!1,this.threadDivId="THREAD_POOL_"+this.serviceName,this.chartDivId="chart_THREAD_POOL_"+this.serviceName,this.dataDivId=this.chartDivId+"_monitor_data",this.refresh=function(t){this.preProcessData(t),this.render(),this.updateCircle(),this.updateData()},this.render=function(){if(!this.initialized){var a=t("<div></div>").attr("id",this.threadDivId).addClass("monitor").css({position:"relative"});t("#"+this.parentDivId).append(a),this.addChart(a),this.addTitle(a),this.addData(a),this.initialized=!0}},this.clear=function(){t(this.threadDivId).empty(),delete this.threadDivId,t(this.chartDivId).empty(),delete this.chartDivId,t(this.dataDivId).empty(),delete this.dataDivId,delete this.data},this.addChart=function(a){var e=t("<div></div>").attr("id",this.chartDivId).addClass("chart").css({position:"absolute",top:"0px",left:"0",float:"left",width:"100%",height:"100%"});a.append(e),this.addCircle(this.chartDivId)},this.addCircle=function(t){a.select("#"+t).append("svg:svg").attr("width","100%").attr("height","100%").append("svg:circle").style("fill","green").attr("cx","30%").attr("cy","30%").attr("r",5)},this.updateCircle=function(){var t=K(this.data.ratePerSecondPerHost);parseInt(t)>parseInt(m)&&(t=m);var e=B(this.data.ratePerSecondPerHost);parseInt(e)>parseInt(C)&&(e=C);var i=M(this.data.ratePerSecondPerHost);parseInt(i)>parseInt(D)&&(i=D),a.selectAll("#"+this.chartDivId+" circle").transition().duration(400).attr("cy",e).attr("cx",t).attr("r",i).style("fill",z(this.data.errorPercentage))},this.addTitle=function(a){var e='<p class="name"'+this.serviceName+">"+this.serviceName+"</p>",i=t("<div></div>").css({position:"absolute",top:"0px",width:"100%",height:"15px",opacity:"0.8",background:"white"}).html(e);a.append(i)},this.addData=function(a){var e=t("<div></div>");t(e).css({position:"absolute",top:"15px",opacity:"0.8",background:"white",width:"100%",height:"95%"}),a.append(e);var i=t("<div></div>").attr("id",this.dataDivId).addClass("monitor_data");e.append(i)},this.updateData=function(){if(this.initialized){var a=t("#"+this.dataDivId);a.empty();var e=t("<div></div>").addClass("spacer");a.append(e),this.addRate(a),this.addDataTable(a)}},this.addRate=function(a){var e='<a href="javascript://" title="Total Execution Rate per Second per Reporting Host" class="hystrix-tooltip rate"><span class="smaller">Host: </span><span class="ratePerSecondPerHost">'+this.data.ratePerSecondPerHost+"</span>/s</a>",i=t("<div></div>").addClass("rate").html(e);a.append(i);var s='<a href="javascript://" title="Total Execution Rate per Second for Cluster" class="hystrix-tooltip rate"><span class="smaller">Cluster: </span><span class="ratePerSecond">'+this.data.ratePerSecond+"</span>/s</a>",r=t("<div></div>").addClass("rate").html(s);a.append(r)},this.addDataTable=function(a){var e=t("<div></div>").addClass("spacer");a.append(e);var i=t('<div class="tableRow"><div class="cell header left">Active</div><div class="cell data left">'+this.data.currentActiveCount+' </div><div class="cell header right">Max Active</div><div class="cell data right">'+this.data.rollingMaxActiveThreads+"</div></div>");a.append(i);var s=t('<div class="tableRow"><div class="cell header left">Queued</div><div class="cell data left"><span class="value">'+this.data.currentQueueSize+'</span>ms </div><div class="cell header right">Executions</div><div class="cell data right"><span class="value">'+this.data.rollingCountThreadsExecuted+"</span>ms </div></div>");a.append(s);var r=t('<div class="tableRow"><div class="cell header left">Pool Size</div><div class="cell data left"><span class="value">'+this.data.currentPoolSize+'</span>ms</div><div class="cell header right">Queue Size</div><div class="cell data right"><span class="value">'+this.data.propertyValue_queueSizeRejectionThreshold+"</span>ms</div></div>");a.append(r)},this.preProcessData=function(t){this.data={};var a=d(t,this.circuitKey+".reportingHosts",1);this.data.reportingHosts=a;var e=d(t,this.circuitKey+".propertyValue_queueSizeRejectionThreshold",0);this.data.propertyValue_queueSizeRejectionThreshold=n(e/a);var i=d(t,this.circuitKey+".propertyValue_metricsRollingStatisticalWindowInMilliseconds",0);this.data.propertyValue_metricsRollingStatisticalWindowInMilliseconds=n(i/a);var s=this.data.propertyValue_metricsRollingStatisticalWindowInMilliseconds/1e3,r=d(t,this.circuitKey+".rollingCountThreadsExecuted",1);r<0&&(r=0),this.data.ratePerSecond=n(r/s),this.data.ratePerSecondPerHost=n(r/s/a),this.data.currentActiveCount=d(t,this.circuitKey+".currentActiveCount",1),this.data.rollingMaxActiveThreads=d(t,this.circuitKey+".rollingMaxActiveThreads",1),this.data.currentQueueSize=d(t,this.circuitKey+".currentQueueSize",1),this.data.rollingCountThreadsExecuted=d(t,this.circuitKey+".rollingCountThreadsExecuted",1),this.data.currentPoolSize=d(t,this.circuitKey+".currentPoolSize",1),this.data.propertyValue_queueSizeRejectionThreshold=d(t,this.circuitKey+".propertyValue_queueSizeRejectionThreshold",1)}}function y(a){var e=t("#dependencyThreadPools div.monitor");E="alph_"+a,e.tsort("p.name",{order:a})}function f(a){var e=t("#dependencyThreadPools div.monitor");E="rate_"+a,e.tsort({order:a,attr:"rate_value"})}window.HV={version:"1.0.0"},HV.addHystrixDashboard=function(a){P=a;var s=t("<div></div>").attr("id","hystrix-header").html("<h2><span id='title_name'>Hystrix</span></h2>");t(P).append(s);var r=t("<div></div>").addClass("hystrix-container");t(P).append(r),e(r);var d=t("<div></div>").addClass("spacer");t(r).append(d),i(r)},HV.init=function(){},HV.refresh=function(t){if(P){H(t);for(var a in _)_.hasOwnProperty(a)&&_[a].refresh(t);for(var e in x)x.hasOwnProperty(e)&&x[e].refresh(t)}},HV.clear=function(){for(var t in _)_.hasOwnProperty(t)&&_[t].clear();_={};for(var a in x)x.hasOwnProperty(a)&&x[a].clear();x={}};var g={COUNTER:{type:"counters"},GAUGE:{type:"gauges"},METER:{type:"meters"},TIMER:{type:"timers"}};Object.freeze(g);Object.freeze(100);var m="40%";Object.freeze(m);var C="40%";Object.freeze(C);var D="125";Object.freeze(D);var P,I,S,_={},x={},H=function(a){for(var e in a)if(a.hasOwnProperty(e)&&e===g.GAUGE.type){var i=a[g.GAUGE.type];t.each(i,function(t,a){s(t),r(t)})}},R=a.scalePow().exponent(.5).domain([0,400]).range(["5",D]),T=a.scaleLinear().domain([0,400]).range(["30%",m]),j=a.scaleLinear().domain([0,400]).range(["30%",C]),V=a.scaleLinear().domain([10,25,40,50]).range(["green","#FFCC00","#FF9900","red"]),w=a.scaleLinear().domain([0,10,35,50]).range(["grey","black","#FF9900","red"]),b="alph_asc";HV.sortByVolume=function(){var t="desc";"rate_desc"==b&&(t="asc"),o(t)},HV.sortByError=function(){var t="desc";"error_desc"==b&&(t="asc"),h(t)},HV.sortByErrorThenVolume=function(){var t="desc";"error_then_volume_desc"==b&&(t="asc"),p(t)},HV.sortAlphabetically=function(){var t="asc";"alph_asc"==b&&(t="desc"),v(t)},HV.sortByLatency90=function(){var t="desc";"lat90_desc"==b&&(t="asc"),b="lat90_"+t,this.sortByMetricInDirection(t,".latency90 .value")},HV.sortByLatency99=function(){var t="desc";"lat99_desc"==b&&(t="asc"),b="lat99_"+t,this.sortByMetricInDirection(t,".latency99 .value")},HV.sortByLatency995=function(){var t="desc";"lat995_desc"==b&&(t="asc"),b="lat995_"+t,this.sortByMetricInDirection(t,".latency995 .value")},HV.sortByLatencyMean=function(){var t="desc";"latMean_desc"==b&&(t="asc"),b="latMean_"+t,this.sortByMetricInDirection(t,".latencyMean .value")},HV.sortByLatencyMedian=function(){var t="desc";"latMedian_desc"==b&&(t="asc"),b="latMedian_"+t,this.sortByMetricInDirection(t,".latencyMedian .value")},HV.sortByMetricInDirection=function(a,e){t("#dependencies div.monitor").tsort(e,{order:a})};Object.freeze(2e3);var M=a.scalePow().exponent(.5).domain([0,2e3]).range(["5",D]),B=a.scaleLinear().domain([0,2e3]).range(["30%",m]),K=a.scaleLinear().domain([0,2e3]).range(["30%",C]),z=a.scaleLinear().domain([10,25,40,50]).range(["green","#FFCC00","#FF9900","red"]),E=(a.scaleLinear().domain([0,10,35,50]).range(["grey","black","#FF9900","red"]),"alph_asc");return HV.sortThreadpoolAlphabetically=function(){var t="asc";"alph_asc"==E&&(t="desc"),y(t)},HV.sortThreadpoolByVolume=function(){var t="desc";"rate_desc"==E&&(t="asc"),f(t)},HV});